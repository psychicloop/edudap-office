{% extends "base.html" %}
{% block content %}

{% if current_user.role == 'Admin' %}
<div class="card border-0 shadow-sm mb-4" style="background: #f0f4ff;">
    <div class="card-body">
        <h5 class="fw-bold mb-3 text-primary"><i class="bi bi-plus-circle me-2"></i>Assign New Task</h5>
        <form method="POST" class="row g-3">
            <input type="hidden" name="assign_task" value="1">
            <div class="col-md-4"><input type="text" name="title" class="form-control" placeholder="Task Title" required></div>
            <div class="col-md-3">
                <select name="employee_id" class="form-select" required>
                    <option value="">Select Employee...</option>
                    {% for emp in employees %}<option value="{{ emp.id }}">{{ emp.username }}</option>{% endfor %}
                </select>
            </div>
            <div class="col-md-3"><input type="datetime-local" name="deadline" class="form-control"></div>
            <div class="col-md-2"><button type="submit" class="btn btn-primary w-100">Assign</button></div>
            <div class="col-12"><textarea name="description" class="form-control" placeholder="Task Details..." rows="2"></textarea></div>
        </form>
    </div>
</div>
{% endif %}

<div class="row g-4">
    {% for task in tasks %}
    <div class="col-md-6">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
                <span class="badge bg-warning text-dark">{{ task.status }}</span>
                <small class="text-muted">Deadline: {{ task.deadline.strftime('%d %b %H:%M') if task.deadline else 'None' }}</small>
            </div>
            <div class="card-body">
                <h5 class="fw-bold">{{ task.title }}</h5>
                <p class="text-muted small">{{ task.description }}</p>
                <hr>
                <div class="bg-light p-3 rounded mb-3" style="height: 150px; overflow-y: auto; font-size: 0.85rem; white-space: pre-wrap;">{{ task.chat_history or 'No updates yet.' }}</div>
                
                <form method="POST" class="d-flex gap-2">
                    <input type="hidden" name="update_chat" value="1">
                    <input type="hidden" name="task_id" value="{{ task.id }}">
                    <input ty{% extends "base.html" %}
{% block content %}

{% if current_user.role == 'Admin' %}
<div class="card border-0 shadow-sm mb-4" style="background: #f0f4ff;">
    <div class="card-body">
        <h5 class="fw-bold mb-3 text-primary"><i class="bi bi-plus-circle me-2"></i>Assign New Task</h5>
        <form method="POST" class="row g-3">
            <input type="hidden" name="assign_task" value="1">
            <div class="col-md-4"><input type="text" name="title" class="form-control" placeholder="Task Title" required></div>
            <div class="col-md-3">
                <select name="employee_id" class="form-select" required>
                    <option value="">Select Employee...</option>
                    {% for emp in employees %}<option value="{{ emp.id }}">{{ emp.username }}</option>{% endfor %}
                </select>
            </div>
            <div class="col-md-3"><input type="datetime-local" name="deadline" class="form-control"></div>
            <div class="col-md-2"><button type="submit" class="btn btn-primary w-100">Assign</button></div>
            <div class="col-12"><textarea name="description" class="form-control" placeholder="Task Details..." rows="2"></textarea></div>
        </form>
    </div>
</div>
{% endif %}

<div class="row g-4">
    {% for task in tasks %}
    <div class="col-md-6">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
                <span class="badge bg-warning text-dark">{{ task.status }}</span>
                <small class="text-muted">Deadline: {{ task.deadline.strftime('%d %b %H:%M') if task.deadline else 'None' }}</small>
            </div>
            <div class="card-body">
                <h5 class="fw-bold">{{ task.title }}</h5>
                <p class="text-muted small">{{ task.description }}</p>
                <hr>
                <div class="bg-light p-3 rounded mb-3" style="height: 150px; overflow-y: auto; font-size: 0.85rem; white-space: pre-wrap;">{{ task.chat_history or 'No updates yet.' }}</div>
                
                <form method="POST" class="d-flex gap-2">
                    <input type="hidden" name="update_chat" value="1">
                    <input type="hidden" name="task_id" value="{{ task.id }}">
                    <input type="text" name="message" class="form-control form-control-sm" placeholder="Type update..." required>
                    {% if current_user.role != 'Admin' %}
                    <select name="status" class="form-select form-select-sm" style="width: 120px;">
                        <option value="In Progress">Working</option>
                        <option value="Completed">Done</option>
                    </select>
                    {% endif %}
                    <button type="submit" class="btn btn-dark btn-sm"><i class="bi bi-send"></i></button>
                </form>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}pe="text" name="message" class="form-control form-control-sm" placeholder="Type update..." required>
                    {% if current_user.role != 'Admin' %}
                    <select name="status" class="form-select form-select-sm" style="width: 120px;">
                        <option value="In Progress">Working</option>
                        <option value="Completed">Done</option>
                    </select>
                    {% endif %}
                    <button type="submit" class="btn btn-dark btn-sm"><i class="bi bi-send"></i></button>
                </form>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}
