{% extends "base.html" %}
{% block title %}Dashboard Â· EduDAP{% endblock %}
{% block breadcrumb %}Workspace / Dashboard{% endblock %}

{% block content %}
<div class="row g-4 mb-4">
    <div class="col-md-3">
        <div class="card p-3 shadow-sm border-0" style="border-left: 4px solid #0B3C78!important;">
            <small class="text-muted fw-bold">TOTAL FILES</small>
            <h2 class="mb-0">{{ total_files }}</h2>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card p-3 shadow-sm border-0" style="border-left: 4px solid #4D7A52!important;">
            <small class="text-muted fw-bold">ACTIVE VENDORS</small>
            <h2 class="mb-0">{{ vendor_count }}</h2>
        </div>
    </div>
</div>

<div class="card shadow-sm border-0 mb-4">
    <div class="card-body">
        <form action="{{ url_for('admin.dashboard') }}" method="GET" class="d-flex gap-2">
            <input type="text" name="q" class="form-control form-control-lg" placeholder="Search Cat No, Chemical, or Make..." value="{{ search_query }}">
            <button type="submit" class="btn btn-primary px-4 fw-bold">SEARCH</button>
        </form>
    </div>
</div>

{% if results.product_matches %}
<div class="card shadow-sm border-0 mb-4">
    <div class="card-header bg-white"><h5 class="mb-0">Search Results</h5></div>
    <table class="table table-hover align-middle mb-0">
        <thead class="bg-light"><tr><th>Item</th><th>Make</th><th>Cat No</th><th>Rate</th></tr></thead>
        <tbody>
        {% for item in results.product_matches %}
        <tr>
            <td>{{ item.item_name }}</td>
            <td>{{ item.make }}</td>
            <td>{{ item.cat_no }}</td>
            <td class="text-success fw-bold">{{ item.rate }}</td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}

<div class="card shadow-sm border-0">
    <div class="card-header bg-white"><h6 class="mb-0 fw-bold">Recent Uploads</h6></div>
    <table class="table table-hover align-middle mb-0">
        <thead class="bg-light"><tr><th class="ps-4">File Name</th><th>User</th><th>Date</th></tr></thead>
        <tbody>
            {% for f in files %}
            <tr>
                <td class="ps-4 fw-bold">{{ f.filename }}</td>
                <td>{{ f.uploader.username }}</td>
                <td class="text-muted small">{{ f.upload_date.strftime('%Y-%m-%d') }}</td>
            </tr>
            {% else %}
            <tr><td colspan="3" class="text-center py-4 text-muted">No files uploaded yet.</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
