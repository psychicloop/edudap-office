{% extends "base.html" %}
{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card border-0 shadow-sm mb-4">
            <div class="card-body text-center py-5">
                <h4 class="fw-bold mb-2">{{ today.strftime('%A, %d %B %Y') }}</h4>
                {% if not record %}
                    <form method="POST" id="punchInForm">
                        <input type="hidden" name="action" value="punch_in"><input type="hidden" name="latitude" id="lat"><input type="hidden" name="longitude" id="lng">
                        <button type="button" onclick="getLocationAndSubmit()" class="btn btn-primary px-5 py-2 fw-bold" style="background-color: var(--edudap-green); border: none;">PUNCH IN</button>
                        <p id="geoMsg" class="text-muted small mt-2"></p>
                    </form>
                {% elif record.in_time and not record.out_time %}
                    <div class="text-success fw-bold mb-4">Punched In at {{ record.in_time.strftime('%I:%M %p') }}</div>
                    <form method="POST"><input type="hidden" name="action" value="punch_out"><button type="submit" class="btn btn-danger px-5 py-2 fw-bold">PUNCH OUT</button></form>
                {% else %}
                    <div class="alert alert-success d-inline-block">Day Completed</div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
<script>
function getLocationAndSubmit() {
    var msg = document.getElementById("geoMsg");
    msg.innerHTML = "Locating (High Accuracy)...";
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(position) {
            document.getElementById("lat").value = position.coords.latitude;
            document.getElementById("lng").value = position.coords.longitude;
            msg.innerHTML = "Found. Submitting...";
            document.getElementById("punchInForm").submit();
        }, function(error) { msg.innerHTML = "Error: Location required."; }, { enableHighAccuracy: true });
    } else { msg.innerHTML = "Geolocation not supported."; }
}
</script>
{% endblock %}
